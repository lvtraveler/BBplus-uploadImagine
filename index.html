<!doctype html>
<html lang="en" class="supported">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>BBTool图片压缩</title>
	<link href="http://libs.baidu.com/bootstrap/3.0.3/css/bootstrap.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="css/default.css">
    <link href="css/fileinput.css" media="all" rel="stylesheet" type="text/css" />	
    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <link rel="shortcut icon" href="http://cn.babybus.com/favicon.png">
    <link rel="stylesheet" href="css/common.css"/>
</head>
<body class="home png">
	<header>
			<nav>
				<ul>
					<li><a href="javascript:void(0)">主页</a></li>
					<li><a href="javascript:void(0)">其他工具</a></li>
				</ul>
			</nav>
		         <div class="kv-main">
								<div id="drop_area">将图片拖拽到此区域
										<input id="uploadFile" type="file" multiple="multiple" class="uploadFile" accept="image/*" onchange="uploadFile(this)" />
								</div>
								<form id="preview" name="previewForm" action="upload.php" method="post" enctype="multipart/form-data">
								</form>
			   		</div>
	</header>
	<main class="highlight">
			<div class="hgroup">
				<h1>BBTool's <strong>PNG</strong> Compress</h1>
				<h2>超强大图片压缩工具，为你带来体面服务.</h2></div> 
			<section>
				<aside>
					<a href=http://www.voormedia.com/jobs target=_blank class="block hiring light">
						<div class="sign"></div>
						<h2>We are looking for code ninjas and design heroes!</h2></a><a href=/photoshop class="block dark grass-full"><h2>Photoshop <strong>JPEG</strong> update</h2><p>We added support for <strong>JPEG</strong>! Save your JPEG and PNG images intelligently with minimal file size and optimal quality.</p><div class=button>Get Photoshop plugin</div></a>
					<div
					class="block extensions">
						<h2>Ready made extensions</h2>
						<p>Compress all your images <strong>automatically</strong>!</p><a href=https://www.magentocommerce.com/magento-connect/compress-jpeg-png-images.html class="button magento">Magento extension</a><a href="https://wordpress.org/plugins/tiny-compress-images/"
						class="button wordpress">WordPress plugin</a></div><a href="https://tinyjpg.com/" class="block readmore jpg"><h2>Hooray! We launched <strong>TinyJPG!</strong> Start compressing your JPEG images now.</h2><img  alt="Compress JPEG images"></a></aside>
				<article>
					<div class="halves">
						<div class="half">
							<h3>What does TinyPNG do?</h3>
							<p>TinyPNG uses smart lossy compression techniques to <strong>reduce the file size</strong> of your PNG files. By selectively decreasing the number of colors in the image, fewer bytes are required to store the data. The effect is nearly invisible
								but it makes a very large difference in file size!</p>
						</div>
						<div class="half">
							<h3>Why should I use TinyPNG?</h3>
							<p>PNG is useful because it's the only widely supported format that can store partially <strong>transparent images</strong>. The format uses compression, but the files can still be large. Use TinyPNG to shrink images for your apps and sites. It will
								use less bandwidth and <strong>load faster</strong>.</p>
						</div>
					</div>
					<h2>How does it work?</h2>
					<p class="quote">Excellent question! When you upload a PNG (Portable Network Graphics) file, similar colors in your image are combined. This technique is called “quantization”. By reducing the number of colors, 24-bit PNG files can be converted to much smaller 8-bit
						indexed color images. All unnecessary metadata is stripped too. The result: better PNG files with <strong>100% support for transparency</strong>. Have your cake and eat it too!</p>
					<h2>Can anyone tell the difference?</h2>
					<p class="quote">Excellent question! Let me give you a side by side comparison. Below are two photos of my cousin. The left image is saved as 24-bit PNG directly from Adobe Photoshop. On the right is the same image processed by TinyPNG. <strong>Spot any difference?</strong></p>
					<figure class="pngcomparison">
						<div>
							<figure><span class="border"><img  alt="Original file"></span>
								<figcaption>Original transparent PNG
									<br>File size: <em>57 KB</em></figcaption>
							</figure><span class="vs">vs</span>
							<figure><span class="border"><img alt="Compressed transparent PNG file"></span>
								<figcaption>Shrunk transparent PNG
									<br>File size: <em>15 KB</em></figcaption>
							</figure>
						</div>
						</figure>
						<p>In the above image the file size is reduced by <strong>more than 70%</strong>. I have excellent eyesight but can't spot the difference either! Use the optimized image to save bandwidth and loading time and your website visitors will thank you.</p>
						<h2>Is it supported everywhere?</h2>
						<p class="quote">Excellent question! The files produced by TinyPNG are displayed perfectly on all modern browsers <strong>including mobile devices</strong>. Still need to support Internet Explorer 6? It normally ignores PNG transparency and displays a solid background
							color. With TinyPNG the background becomes transparent again. Binary transparency without any workarounds!</p>
						<h2>What about Photoshop?</h2>
						<p class="quote">Excellent question! Only Photoshop CC 2015 can save images as indexed PNG files with alpha transparency. With other versions it is impossible and Photoshop CS5 cannot even display them properly.</p>
						<p>You can use <em>Save for Web</em> to export your images as 24-bit transparent PNG files and upload them to TinyPNG. We'll convert them to tiny indexed PNG files. You can also install the <a href=/photoshop>TinyPNG Photoshop plugin</a>. It allows
							you to scale, preview and save compressed PNG and JPEG images straight from Photoshop.</p>
						<h2>Why did you create TinyPNG?</h2>
						<form method=post action=https://www.paypal.com/cgi-bin/webscr>
							<input name=cmd type=hidden value=_s-xclick>
							<input name=hosted_button_id type=hidden value=TRLZ2WTJ8GHS8>
							<p class=quote>Excellent question! We frequently use PNG images, but were frustrated with the load times. We created TinyPNG in our quest to make our own websites faster and more fun to use with the best compression. If you like TinyPNG please contribute by making
								a <a href="/" onclick="this.parentNode.parentNode.submit(); return false" rel=nofollow>donation</a>.</p>
						</form>
				</article>
			</section>
		</main>
		<footer>
			<div class="container">
				<div class="homes"><a href="https://tinyjpg.com/" title="Compress JPEG images" class="tinyjpg"><span>Compress JPEG</span></a><a href="https://tinypng.com/" title="Compress PNG images" class=tinypng><span>Compress PNG</span></a></div>
				<ul class="columns">
					<li class="column"><a href="#"><strong>友情链接</strong></a>
						<ul>
							<li><a href="http://blog.babybus.com/sm/">BBSM Team</a></li>
							<li><a href="http://blog.babybus.com/plus/">BBPlus Team</a></li>
						</ul>
					</li>
					<li class="column"><a href=/developers><strong>相关工具</strong></a>
						<ul>
							<li><a href="#">Tool01</a></li>
							<li><a href="#">Tool02</a></li>
							<li><a href="#">Tool03</a></li>
							<li><a href="#">Tool04</a></li>
							<li><a href="#">Tool05</a></li>
							<li><a href="#">Tool06</a></li>
						</ul>
					</li>
				</ul>
			</div>
			<div class="bottom">
				<div class="content">
					<div class="credits">
						<p>
							Power by
							<a href="http://http://blog.babybus.com/plus/" title="Made by BBPlus" class="">BBPlus</a>
							&
							<a href="http://blog.babybus.com/sm/" title="Made by BBSM" class="">BBSM</a>
					</div>
				</div>
			</div>
		</footer>
    <!--打包下载区域-->
    <div id="zip_cart_area">﻿
    	<div id="cart_container" style="display: none;">
        <div class="cart_title">
        	<span class="ziptitle">打包下载</span>
        	<span id="info_alert"></span>
        	<span class="clo_x">
        		<a href="javascript:;" class="clo_x_a">隐藏</a>
        	</span>
        </div>
        <img class="cartloader" src="img/ajax-loader.gif" style="display: none;">
        	<ul id="file_cart"></ul>
        <span class="options">
        	<a href="javascript:;" id="client-download-btn" class="download active">Download(<span id="d_c">0</span>)</a>
        	<a href="javascript:;" class="clear">清空</a></span>
    	</div>
    </div>
    
    <div id="zip_tool_int"><a class="show_cart" href="javascript:;">(<span class="items">﻿0</span>)</a></div>
    <div class="flyingAdd" style="left: -1000px; top: -100px; opacity: 1; font-size: 50px;">+</div>
	
		<script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
		<script src="js/bluebird.min.js" type="text/javascript"></script>
		<script src="js/FileSaver.min.js" type="text/javascript"></script>
		<script src="js/jszip.min.js" type="text/javascript"></script>
		<script src="js/jquery.form.js" defer="defer" async="async"></script>
    <script src="http://apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="js/download.js" type="text/javascript" defer="defer" async="async"></script>
    
<script type="text/javascript">
$(function(){
	//阻止浏览器默认行。
	$(document).on({
		dragleave:function(e){		//拖离
			e.preventDefault();
		},
		drop:function(e){			//拖后放
			e.preventDefault();
		},
		dragenter:function(e){		//拖进
			e.preventDefault();
		},
		dragover:function(e){		//拖来拖去
			e.preventDefault();
		}
	});
	//================上传的实现
	var box = document.getElementById('drop_area'); //拖拽区域
	box.addEventListener("drop",function(e){
		e.preventDefault(); //取消默认浏览器拖拽效果
		var fileList = e.dataTransfer.files; //获取文件对象
		var fileFilter=[];//过滤后的文件数组
		var len=fileList.length;
		//检测是否是拖拽文件到页面的操作
		if(fileList.length == 0){
			return false;
		}
		//检测文件是不是图片
		for(var i=0;i<len;i++){
			if(fileList[0].type.indexOf('image') === -1){
				alert("您拖的不是图片！");
				return false;
			}
		}
		//拖拉图片到浏览器，可以实现预览功能
		for(var i=0;i<fileList.length;i++){
			var img = window.URL.createObjectURL(fileList[i]);//获取图像截图
			var filename = fileList[i].name; //图片名称
			var filesize = Math.floor((fileList[i].size)/1024);//图片大小
				if(filesize>5000){
				alert("上传大小不能超过5MB.");
				return false;
			}
				var imgPreviewNum=$(".imgPreview").length;
        var str = "<div class='imgPreview imgPreviewNum"+imgPreviewNum+"'><span class='imageHolder'><img src='"+img+"' style='height:95px;width:95px;' title='"+filename+"'></span><div class='progress'><div class='progress-bar progress-bar-striped active' role='progressbar' aria-valuenow='100' aria-valuemin='0' aria-valuemax='100' style='width:100%'><span class='progress-state'>上传中...</span></div></div><p>图片名称："+filename+"</p><p class='size'>大小："+filesize+"KB</p><p class='size_compress'></p><a class='url_download' href='#' target='_blank' download='"+filename+"'>下载</a><input class='chk_download' type='checkbox' name='files' value='' checked /><p class='state'></p></div>";
        $("#preview").append(str);
				//改变熊猫图片状态
		$('.kv-main').css("background-image","url(./img/panda-png-happy.png)");
		//添加文件
		var files=event.target.files||event.dataTransfer.files;
		fileFilter=fileFilter.concat(filter(files));
		}
			//文件上传
		var self=this;
		if(location.host.indexOf("sitepointstatic")>=0) {
			return; //非站点服务器上运行
		}
		for(var i=0,file;file=fileFilter[i];i++) {
		(function(file){
				//开始上传
				$.get('./js/upload.json','',function(data){
						var upload_data=data.data;
						var upload_len=upload_data.length;
						for(var i=0;i<upload_len;i++){
							var upload_state=upload_data[i].state;
							var upload_url=upload_data[i].url;
							if(upload_state){
								//上传成功
								$('.progress-state').text('正在压缩...');
								$('.url_download').hide();
								$('.chk_download').hide();
								//请求压缩数据
								$.post('./js/compress.json',{"url":upload_url},function(data){
									var compress_error=data.error;//压缩状态
									var compress_url=data.url;//压缩后的下载路径
									var compress_size=data.size;//压缩大小
									//填充数据
									if(compress_error){
										//压缩成功
										$('.progress-state').text('压缩完成!');
										$('.progress-bar-striped').removeClass('active');
										$('.url_download').show();
										$('.chk_download').show();
										$('.size_compress').text("压缩大小:"+compress_size);
										$('.url_download').attr("href",compress_url);
										$('input[name="files"]').val(compress_url);
                    var imgUrl=$('.imageHolder img').attr('src');
                    $('.add_cart').attr('href',imgUrl);
                    	//获取已选择的下载个数
										var count_download=$(':checked').length;
										$('.items').text(count_download);
										$('#d_c').text(count_download);
									}else{
										//压缩失败
										$('.url_download').text("压缩失败!");
									}
								});
								
							}else{
								//不成功
								$('.progress-bar').css('background-color','#E63D3D');
								$('.progress-state').text('上传失败!');
								return false;
							}
						}
						
				},'json');
				
		})(file);
	}
	
});
});
</script>
<!--点击上传触发事件-->
<script>
//加载进度条
var timer=null;
var width=0;
var filter=function(files){
   	return files;
   }
//点击上传
function uploadFile(obj){
		var fileList=obj.files;//获取上传文件对象
   	var fileFilter=[];//过滤后的文件数组
		var len=fileList.length;
		for(var i=0;i<len;i++){
			//判断是否是图片类型的文件
			if(fileList[i].type.indexOf('image')===-1){
				alert("请上传图片！");
				return false;
			}
		}
		//判断图片大小
		for(var j=0;j<len;j++){
			var img = window.URL.createObjectURL(fileList[j]);//获取图像截图
			var filename = fileList[j].name; //图片名称
			var filesize = Math.floor((fileList[j].size)/1024);//图片大小
			if(filesize>5000){
					alert("上传大小不能超过5MB.");
					return false;
				}
			//预览图片
				var imgPreviewNum=$(".imgPreview").length;
        var str = "<div class='imgPreview imgPreviewNum"+imgPreviewNum+"'><span class='imageHolder'><img src='"+img+"' style='height:95px;width:95px;' title='"+filename+"'></span><div class='progress'><div class='progress-bar progress-bar-striped active' role='progressbar' aria-valuenow='100' aria-valuemin='0' aria-valuemax='100' style='width:100%'><span class='progress-state'>上传中...</span></div></div><p>图片名称："+filename+"</p><p class='size'>大小："+filesize+"KB</p><p class='size_compress'></p><a class='url_download' href='#' target='_blank' download='"+filename+"'>下载</a><input class='chk_download' type='checkbox' name='files' value='' checked /><p class='state'></p></div>";
        $("#preview").append(str);
		//改变熊猫图片状态
		$('.kv-main').css("background-image","url(./img/panda-png-happy.png)");
		//添加文件
		var files=event.target.files||event.dataTransfer.files;
		fileFilter=fileFilter.concat(filter(files));
	}
	//文件上传
	var self=this;
	if(location.host.indexOf("sitepointstatic")>=0) {
		return; //非站点服务器上运行
	}
	for(var i=0,file;file=fileFilter[i];i++) {
		(function(file){
				//开始上传
				$.get('./js/upload.json','',function(data){
						var upload_data=data.data;
						var upload_len=upload_data.length;
						for(var i=0;i<upload_len;i++){
							var upload_state=upload_data[i].state;
							var upload_url=upload_data[i].url;
							if(upload_state){
								//上传成功
								$('.progress-state').text('正在压缩...');
								$('.url_download').hide();
								$('.chk_download').hide();
								//请求压缩数据
								$.post('./js/compress.json',{"url":upload_url},function(data){
									data=JSON.parse(data);
									var compress_error=data.error;//压缩状态
									var compress_url=data.url;//压缩后的下载路径
									var compress_size=data.size;//压缩大小
									//填充数据
									if(compress_error){
										//压缩成功
										$('.progress-state').text('压缩完成!');
										$('.progress-bar-striped').removeClass('active');
										$('.url_download').show();
										$('.chk_download').show();
										
										$('.size_compress').text("压缩大小:"+compress_size);
										$('.url_download').attr("href",compress_url);
										$('input[name="files"]').val(compress_url);
                    var imgUrl=$('.imageHolder img').attr('src');
                    $('.add_cart').attr('href',imgUrl);
                    	//获取已选择的下载个数
										var count_download=$(':checked').length;
										$('.items').text(count_download);
										$('#d_c').text(count_download);
									}else{
										//压缩失败
										$('.url_download').text("压缩失败!");
									}
								});
								
							}else{
								//不成功
								$('.progress-bar').css('background-color','#E63D3D');
								$('.progress-state').text('上传失败!');
								return false;
							}
						}
						
				},'json');
				
		})(file);
	}
}
//加载进度条
function onChange(width){
	var imgPreviewNum="imgPreviewNum"+($(".imgPreview").length-1);
			if(width==95){
					window.clearTimeout(timer);
			}else{
					width+=1;
					$("."+imgPreviewNum).find(".progressBar").css('width',width+"px");
					timer=window.setTimeout("onChange("+width+")",10);
			}
}
</script>
<!--监听checkbox的变化-->
<script type="text/javascript">
		$('.chk_download').bind('click',function(){
				$(this).change(function(){
						if($(this).is(':checked')){
							var count_download=$(':checked').length;
							$('.items').text(count_download);
							$('#d_c').text(count_download);
						}else{
							var count_download=$(':checked').length;
							$('.items').text(count_download);
							$('#d_c').text(count_download);
						}
				});
			});
</script>
<script type="text/javascript">
//添加
    $('.add_cart').on('click',function(){
        var file=$(this).attr('href');
        var title=$(this).attr('id');
        $("div#cart_container").fadeIn("medium");
        var offset = $(this).offset();
        var offsetfavbar = $("div#cart_container").offset();
        $(".flyingAdd").css('left', offset.left + 'px');
        $(".flyingAdd").css('top', offset.top + 'px');
        $(".flyingAdd").animate({
            left: (offsetfavbar.left + 200) + "px",
            top: (offsetfavbar.top) + "px",
            opacity: "0.1",
            fontSize: "0px"
        }, 400, function () {
            $(".flyingAdd").css({left: "-1000px", top: "-100px", opacity: "1", fontSize: "50px"})
        });
        $.ajax({
            url: '/js/zipcart.json',
            data: 'cart=1&file=' + file + '&title=' + title,
            success: function ($files) {
                $('ul#file_cart').html("");
                $($files).appendTo('ul#file_cart').show();
                var size = $('ul#file_cart > li').size();
                $('.items').text(size);
                $('#d_c').text(size);
                if (size > 50) {
                    $('#info_alert').text('最多打包50个！');
                    alert("一次最后打包下载50个!");
                }
            }
        });
        return false;
    });
//清空
$('a.clear').on('click', function () {
    if (!confirm('确定清空?')) {
        return false;
    }
    $.ajax({
        url: '/js/zipcart.json', data: 'clear=1', success: function ($size) {
            $('.items').text($size);
            $('div#cart_container').fadeOut("medium", function () {
                $('ul#file_cart > li').each(function (i, val) {
                    $(this).remove();
                });
            });
        }
    });
    $('.items').text("0");
    $('#d_c').text("0");
    return false;
});
// 打包下载
//$('a.download').on('click', function () {
//  var downloads = new Array();
//  $('ul#file_cart > li a').each(function (i, val) {
//      downloads[i] = $(this).attr('title');
//  });
//  if (downloads.length == 0) {
//      alert('您的文件已空!');
//  }
//  else if (downloads.length < 51) {
//      $('div#cart_container').fadeOut("medium", function () {
//          $('ul#file_cart').html("");
//      });
//      var idarry = downloads.join();
//      window.location.href = '/js/get_zip_api.json?id=' +idarry;
//      $('.items').text("0");
//      $('#d_c').text("0");
//  } else {
//      alert('一次最后打包下载50个!');
//  }
//  return false;
//});

//使用客户端的方式打包下载



//隐藏
$('a.clo_x_a').on('click', function () {
    $('div#cart_container').fadeOut();
});
//显示
$('a.show_cart').on('click', function () {
    if (!$('div#cart_container').is(':visible')) {
        $('div#cart_container').fadeIn("medium", function () {
            $('<img class="cartloader" src="img/ajax-loader.gif"/>').insertBefore($('ul#file_cart'));
//          $.ajax({
//              url: '/js/zipcart.json', data: 'showcart=1', success: function ($files) {
//                  $('img.cartloader').fadeOut();
//                  $('ul#file_cart').html("");
//                  if (!$files) {
//                      $files = "<div class='nofiles'>No files in your cart, click '+' add files</div>";
//                  }
//                  $('ul#file_cart').html($files).fadeIn();
//              }
//          });
        });
    } else {
        $('div#cart_container').fadeOut();
    }
    return false;
});
</script>

</body>
</html>